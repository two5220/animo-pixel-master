<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Animo Pixel Master - 제미나이 워터마크 제거 & 이미지 분할/압축 도구</title>
    <meta name="description"
        content="AI 워터마크 제거, 인스타그램용 이미지 분할, 고화질 용량 압축을 무료로 제공합니다. 서버 업로드 없는 안전한 클라이언트 사이드 이미지 처리 도구입니다.">
    <meta name="keywords" content="이미지 분할, 워터마크 제거, 제미나이, 사진 용량 줄이기, 인스타그램 그리드, 이미지 자르기, 무료 웹툴">
    <meta name="author" content="Animo">
    <meta property="og:title" content="Animo Pixel Master">
    <meta property="og:description" content="설치 없이 바로 쓰는 강력한 이미지 편집 도구. 워터마크 제거부터 분할 저장까지.">
    <meta property="og:type" content="website">
    <meta name="theme-color" content="#121212">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="manifest" href="manifest.json">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        /* [공통 변수] */
        :root {
            --primary: #00e676;
            --primary-dim: rgba(0, 230, 118, 0.1);
            --bg-dark: #121212;
            --panel-bg: #1e1e1e;
            --surface: #252525;
            --border: #333;
            --text-main: #ffffff;
            --text-sub: #aaaaaa;
            --danger: #ff5252;
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 8px;
            --gem-accent: #4285f4;
        }

        * {
            box-sizing: border-box;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 0%, #1a3a2a 0%, #121212 60%);
            color: var(--text-main);
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            padding-bottom: 50px;
        }

        /* 숫자 입력 화살표 제거 */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
        }

        /* [PC 전용 레이아웃: 1024px 이상] */
        @media (min-width: 1024px) {
            .container {
                max-width: 1400px !important;
                padding: 3rem !important;
            }

            .dashboard-layout {
                display: flex;
                gap: 25px;
                align-items: flex-start;
                margin-top: 20px;
                text-align: left;
            }

            .workspace-left {
                flex: 4;
                min-width: 0;
            }

            #previewContainer {
                height: 650px !important;
                margin-bottom: 0 !important;
            }

            .workspace-right {
                flex: 1;
                min-width: 280px;
                max-width: 340px;
                background: var(--surface);
                padding: 20px;
                border-radius: var(--radius-md);
                border: 1px solid var(--border);
            }

            .pc-tab-menu {
                display: flex !important;
                gap: 5px;
                margin-bottom: 15px;
            }

            .tab-btn {
                flex: 1;
                height: 60px !important;
                padding: 5px !important;
                line-height: 1.3 !important;
                white-space: pre-wrap !important;
                display: flex !important;
                justify-content: center;
                align-items: center;
                text-align: center;
                border-radius: 12px !important;
                font-size: 1.15rem !important;
            }

            .pc-br {
                display: inline !important;
            }

            /* PC Controls Wrapper 수정 */
            .pc-controls-wrapper {
                display: flex !important;
                gap: 10px;
                margin-bottom: 15px;
                padding: 15px;
                background: #181818;
                border-radius: 12px;
                border: 1px solid #333;
                align-items: center;
                flex-wrap: wrap; /* 내용 많으면 줄바꿈 */
            }

            .btn-group-vertical {
                display: flex !important;
                flex-direction: column !important;
                gap: 8px !important;
                width: 45px;
                flex-shrink: 0;
            }

            .tab-attach {
                width: 100% !important;
                height: 40px !important;
                border-radius: 8px !important;
                font-size: 1.8rem !important;
                line-height: 1 !important;
                margin: 0 !important;
                display: flex !important;
                justify-content: center !important;
                align-items: center !important;
                padding: 0 !important;
                padding-bottom: 4px !important;
            }

            .tab-delete {
                width: 100% !important;
                height: 40px !important;
                border-radius: 8px !important;
                font-size: 1rem !important;
                margin: 0 !important;
            }

            .chk-group-vertical {
                display: flex !important;
                flex-direction: column !important;
                justify-content: center;
                gap: 10px !important;
                align-items: flex-start !important;
                min-width: 100px;
            }

            /* 상단으로 이동된 입력 필드 그룹 스타일 */
            .quick-inputs-group {
                display: flex;
                flex: 1;
                gap: 5px;
                justify-content: flex-end;
            }

            .quick-input-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 4px;
                flex: 1;
            }
            
            .quick-input-item label {
                font-size: 0.75rem;
                color: #888;
                white-space: nowrap;
            }

            .quick-input-item input {
                width: 100%;
                background: #252525;
                border: 1px solid #444;
                color: #fff;
                padding: 8px 0;
                border-radius: 6px;
                text-align: center;
                font-weight: bold;
                font-size: 0.9rem;
            }

            #splitPanel,
            #cropPanel {
                grid-template-columns: 1fr 1fr !important;
                padding: 15px !important;
                background: rgba(0, 0, 0, 0.2) !important;
                margin-bottom: 15px !important;
            }

            #splitPanel {
                grid-template-columns: 1fr !important; /* 입력필드 빠져서 1열로 변경 */
                gap: 10px !important;
            }

            .ratio-select-wrapper {
                width: 100%;
                grid-column: span 1;
                position: relative;
            }

            .ratio-select {
                width: 100%;
                padding: 9px 12px;
                padding-right: 50px;
                background: #151515;
                color: #fff;
                border: 1px solid #333;
                border-radius: 10px;
                font-size: 0.9rem;
                font-weight: bold;
                cursor: pointer;
                outline: none;
                appearance: none;
                -webkit-appearance: none;
                -moz-appearance: none;
                text-align: center;
                text-align-last: center;
                background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
                background-repeat: no-repeat;
                background-position: right 5px center;
                background-size: 30px;
            }

            .ratio-select:hover {
                border-color: var(--primary);
            }

            .ratio-inputs-row {
                gap: 10px !important;
                width: 100%;
                grid-column: span 1;
                margin-top: 3px !important;
            }

            .ratio-inputs-row input {
                flex: 1;
                text-align: center;
                padding: 9px 0 !important;
            }

            .main-btn {
                padding: 18px !important;
                font-size: 1.1rem !important;
                width: 100%;
            }

            .preset-btns {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px !important;
                margin-top: 5px;
                height: 100%;
                width: 100%;
            }

            .preset-btn {
                background: #2d2d2d;
                border: 2px solid #333;
                color: #ccc;
                font-size: 0.9rem;
                padding: 9px 0 !important;
                border-radius: 12px;
                cursor: pointer;
                transition: all 0.2s;
                display: flex;
                justify-content: center;
                align-items: center;
                font-weight: 800;
            }

            .preset-btn:hover {
                border-color: #777;
                background: #383838;
                color: #fff;
            }

            .preset-btn.active {
                border: 2px solid var(--primary);
                color: #fff;
                background: linear-gradient(180deg, rgba(0, 230, 118, 0.1) 0%, rgba(0, 230, 118, 0.2) 100%);
                box-shadow: 0 4px 12px rgba(0, 230, 118, 0.2);
            }
        }

        /* [모바일 전용 레이아웃 수정] */
        @media (max-width: 1023px) {
            .dashboard-layout {
                display: flex;
                flex-direction: column;
                gap: 15px;
            }

            /* 모바일 컨트롤 래퍼 수정: 입력필드 포함 */
            .pc-controls-wrapper {
                display: flex !important;
                gap: 12px;
                background: var(--surface);
                padding: 12px;
                border-radius: var(--radius-md);
                border: 1px solid var(--border);
                margin-bottom: 15px;
                align-items: center;
                justify-content: space-between;
            }

            /* 수정: 체크박스 수직 배열 */
            .chk-group-vertical {
                display: flex !important;
                flex-direction: column !important;
                gap: 8px !important;
                padding: 0 !important;
                border: none !important;
                background: transparent !important;
                margin-bottom: 0 !important;
                align-items: flex-start !important;
                flex-shrink: 0;
            }

            /* 상단으로 이동된 입력 필드 그룹 (모바일) */
            .quick-inputs-group {
                display: flex;
                flex: 1;
                gap: 6px;
                justify-content: flex-end;
            }

            .quick-input-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 2px;
                width: 30%;
                min-width: 45px;
            }

            .quick-input-item label {
                font-size: 0.7rem;
                color: #888;
                white-space: nowrap;
            }

            .quick-input-item input {
                width: 100%;
                background: #252525;
                border: 1px solid #444;
                color: #fff;
                padding: 10px 0;
                border-radius: 8px;
                text-align: center;
                font-weight: bold;
                font-size: 0.95rem;
            }

            .btn-group-vertical {
                display: flex !important;
                flex-direction: column !important;
                gap: 8px !important;
            }

            .tab-attach {
                width: 44px !important;
                height: 44px !important;
                border-radius: 10px;
                display: flex;
                justify-content: center;
                align-items: center;
                font-weight: 900;
                font-size: 1.6rem;
                background: #2a2a2a;
            }

            .tab-delete {
                width: 44px !important;
                height: 44px !important;
                border-radius: 10px;
                display: flex;
                justify-content: center;
                align-items: center;
                font-weight: 900;
                background: #2a2a2a;
                font-size: 0.9rem;
            }

            #splitPanel {
                grid-template-columns: 1fr !important;
                background: var(--surface) !important;
                padding: 15px !important;
                border-radius: var(--radius-md) !important;
                border: 1px solid var(--border) !important;
                margin-bottom: 15px !important;
            }

            #cropPanel {
                grid-template-columns: 1fr !important;
                background: var(--surface) !important;
                padding: 15px !important;
                border-radius: var(--radius-md) !important;
                border: 1px solid var(--border) !important;
                margin-bottom: 15px !important;
            }

            .ratio-select {
                width: 100%;
                padding: 12px;
                padding-right: 45px;
                background: #151515;
                color: #fff;
                border: 1px solid #333;
                border-radius: 10px;
                font-size: 1rem;
                font-weight: bold;
                cursor: pointer;
                outline: none;
                appearance: none;
                background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
                background-repeat: no-repeat;
                background-position: right 8px top 50%;
                background-size: 24px;
            }

            .preset-btn {
                padding: 12px 0 !important;
                font-size: 0.85rem !important;
            }

            .action-row {
                gap: 10px;
            }

            .main-btn {
                padding: 18px !important;
                font-size: 1.15rem !important;
            }

            .donation-btn {
                padding: 12px !important;
                font-size: 0.85rem !important;
            }
        }

        /* [공통 스타일] */
        .pc-br {
            display: none;
        }

        .ratio-inputs-row {
            display: flex;
            gap: 10px;
            width: 100%;
            margin-top: 10px;
        }

        .ratio-select-wrapper {
            width: 100%;
            position: relative;
        }

        .container {
            background: var(--panel-bg);
            padding: 2rem;
            border-radius: var(--radius-lg);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            text-align: center;
            width: 95%;
            max-width: 620px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            z-index: 10;
            position: relative;
            margin-top: 5vh;
            margin-bottom: 2rem;
        }

        .header-wrap {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1.2rem;
            position: relative;
            width: 100%;
        }

        h1 {
            color: var(--primary);
            margin: 0;
            font-weight: 900;
            font-size: 2.4rem;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, #00e676 0%, #69f0ae 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .sub-text {
            color: var(--text-sub);
            font-size: 1.15rem;
            margin-bottom: 2rem;
            font-weight: 500;
            line-height: 1.5;
            text-align: center;
        }

        .preview-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 8px;
            padding: 0 2px;
        }

        .counter-box {
            font-size: 0.8rem;
            color: #777;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .counter-box b {
            color: var(--primary);
            font-size: 0.9rem;
        }

        .lang-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .flag-icon {
            width: 25px;
            height: 18px;
            border-radius: 2px;
        }

        .lang-select {
            background: #222;
            border: 1px solid #444;
            color: #888;
            font-size: 0.9rem;
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 6px;
            cursor: pointer;
        }

        #previewContainer {
            width: 100%;
            height: 340px;
            background: #000;
            border-radius: var(--radius-md);
            margin-bottom: 1.5rem;
            border: 1px solid #333;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        #previewCanvas {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            cursor: crosshair;
            position: relative;
            z-index: 2;
        }

        #guideText {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #555;
            z-index: 1;
            pointer-events: none;
            padding: 20px;
        }

        #guideText .main-guide {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 12px;
            color: #777;
        }

        #guideText .sub-guide {
            font-size: 0.85rem;
            line-height: 1.6;
            color: #555;
        }

        .tab-menu {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 1.5rem;
            padding: 4px;
            background: #151515;
            border-radius: 12px;
            border: 1px solid #2a2a2a;
        }

        .tab-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: #666;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            color: #000;
            background: var(--primary);
            box-shadow: 0 2px 10px rgba(0, 230, 118, 0.2);
        }

        .tab-attach {
            background: var(--surface);
            color: var(--primary);
            border: 1px solid #333;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .tab-delete {
            background: var(--surface);
            color: var(--danger);
            border: 1px solid #333;
            font-size: 0.75rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chk-label {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.95rem;
            cursor: pointer;
            color: #ccc;
        }

        .chk-label input {
            accent-color: var(--primary);
            width: 18px;
            height: 18px;
        }

        .config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            background: var(--surface);
            padding: 20px;
            border-radius: var(--radius-md);
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
            text-align: left;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            align-items: center;
        }

        label {
            font-size: 0.85rem;
            color: #888;
            font-weight: 700;
            margin-left: 0;
            text-align: center;
            width: 100%;
            white-space: nowrap;
        }

        .input-num {
            background: #151515;
            border: 1px solid #333;
            color: #fff;
            padding: 12px 0;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.1rem;
            width: 100%;
            text-align: center;
        }

        .preset-btns {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 5px;
            height: 100%;
        }

        .preset-btn {
            background: #2d2d2d;
            border: 1px solid #444;
            color: #ccc;
            font-size: 0.9rem;
            padding: 15px 0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 800;
        }

        .preset-btn:hover {
            border-color: #777;
            background: #383838;
            color: #fff;
        }

        .preset-btn.active {
            border: 2px solid var(--primary);
            color: #fff;
            background: linear-gradient(180deg, rgba(0, 230, 118, 0.1) 0%, rgba(0, 230, 118, 0.2) 100%);
            box-shadow: 0 4px 12px rgba(0, 230, 118, 0.2);
        }

        .input-wrapper {
            position: relative;
            width: 100%;
        }

        .input-wrapper input {
            padding-right: 0 !important;
            width: 100%;
            text-align: center !important;
        }

        .action-row {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 1.5rem;
            align-items: stretch;
        }

        .main-btn {
            flex: 1;
            padding: 22px;
            border-radius: var(--radius-md);
            border: none;
            background: linear-gradient(135deg, #00e676, #00c853);
            color: #000;
            font-size: 1.25rem;
            font-weight: 900;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 10px 30px rgba(0, 230, 118, 0.2);
        }

        .main-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0, 230, 118, 0.3);
        }

        .donation-btn {
            flex: 0 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: #ffe812;
            color: #3c1e1e;
            padding: 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            border: none;
            width: 100%;
            font-weight: 800;
            font-size: 0.9rem;
            line-height: 1.4;
            white-space: pre-wrap;
            transition: transform 0.2s;
        }

        .qr-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 20000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(8px);
        }

        .qr-modal.active {
            display: flex;
            animation: fadeIn 0.2s ease-out;
        }

        .qr-box {
            background: #fff;
            padding: 30px;
            border-radius: 24px;
            text-align: center;
            max-width: 340px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .qr-img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 12px;
            border: 1px solid #eee;
        }

        .close-qr {
            margin-top: 20px;
            padding: 14px 0;
            width: 100%;
            background: #222;
            color: #fff;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
        }

        .prompt-view {
            background: #111;
            color: #00e676;
            padding: 15px;
            border-radius: 12px;
            font-family: monospace;
            font-size: 0.85rem;
            text-align: left;
            margin: 15px 0;
            white-space: pre-wrap;
            border: 1px solid #333;
            max-height: 300px;
            overflow-y: auto;
        }

        .copy-btn {
            width: 100%;
            padding: 12px;
            background: var(--gem-accent);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 800;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .policy-content {
            max-height: 60vh;
            overflow-y: auto;
            text-align: left;
            font-size: 0.85rem;
            color: #333;
            line-height: 1.6;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-top: 15px;
        }

        #dropOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
            border: 4px dashed var(--primary);
            display: none;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        #dropOverlay.active {
            display: flex;
        }

        #dropOverlay::after {
            content: '이미지를 이곳에 놓으세요';
            color: var(--primary);
            font-size: 1.8rem;
            font-weight: 800;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body>

    <div class="container" id="mainContainer">
        <div id="dropOverlay"></div>

        <div class="header-wrap">
            <h1>Animo Pixel Master</h1>
        </div>

        <p class="sub-text" data-i18n="sub">화질 저하 없는 제미나이 워터마크 제거<br>고성능 이미지 분할과 이미지 압축</p>

        <div class="dashboard-layout">
            <div class="workspace-left">
                <div class="preview-top-bar">
                    <div class="counter-box">
                        <span data-i18n="visitors">Today's Visitors</span>
                        <b id="cntVisit">0</b>
                    </div>
                    <div class="lang-wrapper">
                        <img id="currentFlag" src="https://flagcdn.com/24x18/kr.png" alt="KR" class="flag-icon">
                        <select class="lang-select" onchange="changeLanguage(this.value)">
                            <option value="ko">KO</option>
                            <option value="en">EN</option>
                            <option value="cn">CN</option>
                            <option value="jp">JP</option>
                        </select>
                    </div>
                </div>

                <div id="previewContainer">
                    <div id="guideText">
                        <div class="main-guide" data-i18n="guide_m">이미지를 이곳에 드래그 하거나<br>+ 버튼을 눌러주세요</div>
                        <div class="sub-guide">
                            <span data-i18n="guide_s">워터마크 삭제는 제미나이만 지원합니다.<br>자동 저장 체크시 드래그만으로 자동 저장됩니다.</span>
                            <div id="mobileGuide" style="color:#00e676; font-weight:bold; margin-top:8px;"></div>
                        </div>
                    </div>
                    <canvas id="previewCanvas" style="display:none;" onmousedown="handleStart(event)"
                        onmousemove="handleMove(event)" onmouseup="handleEnd()" onmouseleave="handleEnd()"
                        ontouchstart="handleStart(event)" ontouchmove="handleMove(event)" ontouchend="handleEnd()">
                    </canvas>
                </div>
            </div>

            <div class="workspace-right">
                <div class="pc-tab-menu tab-menu">
                    <button class="tab-btn active" id="pcTabSplit" onclick="switchTab('split')">
                        <span data-i18n="tab_split">이미지 분할</span>
                    </button>
                    <button class="tab-btn" id="pcTabCrop" onclick="switchTab('crop')">
                        <span data-i18n="tab_crop">이미지 압축</span>
                    </button>
                    <div class="tab-spacer" style="display:none;"></div>
                </div>

                <div class="tab-menu" style="display:none;">
                    <button class="tab-btn active" id="mobTabSplit" onclick="switchTab('split')">
                        <span data-i18n="tab_split">이미지 분할</span>
                    </button>
                    <button class="tab-btn" id="mobTabCrop" onclick="switchTab('crop')">
                        <span data-i18n="tab_crop">이미지 압축</span>
                    </button>
                </div>

                <div class="pc-controls-wrapper">
                    <div class="btn-group-vertical">
                        <label for="fileInput" class="tab-attach">+</label>
                        <div class="tab-delete" onclick="clearFiles()">Del</div>
                    </div>

                    <div class="chk-group-vertical top-options">
                        <label class="chk-label"><input type="checkbox" id="wmCheck"><span data-i18n="wm">워터마크
                                제거</span></label>
                        <label class="chk-label"><input type="checkbox" id="autoCheck"><span data-i18n="auto">자동
                                저장</span></label>
                    </div>

                    <div class="quick-inputs-group" id="quickInputs">
                        <div class="quick-input-item">
                            <label data-i18n="row">가로</label>
                            <input type="number" id="rowInput" value="1" min="1" oninput="resetGridPositions()">
                        </div>
                        <div class="quick-input-item">
                            <label data-i18n="col">세로</label>
                            <input type="number" id="colInput" value="1" min="1" oninput="resetGridPositions()">
                        </div>
                        <div class="quick-input-item">
                            <label data-i18n="border">테두리</label>
                            <input type="number" id="cropInput" value="0.5" step="0.1" oninput="drawVisualizer()">
                        </div>
                    </div>
                </div>

                <div id="splitPanel" class="config-grid">
                    <div class="input-group" style="grid-column: 1 / -1;">
                        <label data-i18n="cut_ratio">이미지 크기</label>
                        <div class="ratio-select-wrapper">
                            <select id="ratioSelectSplit" class="ratio-select"
                                onchange="handleRatioSelect(this, 'split')">
                                <option value="full" data-i18n="full">원본 (자유 변형)</option>
                                <option value="1.777">16:9</option>
                                <option value="0.5625">9:16</option>
                                <option value="1">1:1</option>
                                <option value="custom" data-i18n="custom">비율 입력</option>
                            </select>
                        </div>
                        <div id="customRatioInputSplit" class="ratio-inputs-row" style="display:none;">
                            <input type="number" id="ratioWSplit" class="input-num" value="1"
                                oninput="setRatioFromInput('split')">
                            <input type="number" id="ratioHSplit" class="input-num" value="1"
                                oninput="setRatioFromInput('split')">
                        </div>
                    </div>
                </div>

                <div id="cropPanel" class="config-grid" style="display: none;">
                    <div class="input-group" style="grid-column: 1 / -1;">
                        <label data-i18n="target_cap">압축 용량</label>
                        <div class="preset-btns">
                            <button class="preset-btn" id="p500" onclick="setTargetMB(0.5, this)"><span
                                    data-i18n="p500">500KB 이하</span></button>
                            <button class="preset-btn" id="p1" onclick="setTargetMB(1.0, this)"><span data-i18n="p1">1MB
                                    이하</span></button>
                            <button class="preset-btn" id="p2" onclick="setTargetMB(2.0, this)"><span data-i18n="p2">2MB
                                    이하</span></button>
                            <button class="preset-btn active" id="p5" onclick="setTargetMB(5.0, this)"><span
                                    data-i18n="p5">5MB 이하</span></button>
                        </div>
                    </div>

                    <div class="input-group" style="grid-column: 1 / -1;">
                        <label data-i18n="cut_ratio">이미지 크기</label>
                        <div class="ratio-select-wrapper">
                            <select id="ratioSelect" class="ratio-select" onchange="handleRatioSelect(this, 'crop')">
                                <option value="full" data-i18n="full">원본 (자유 변형)</option>
                                <option value="1.777">16:9</option>
                                <option value="0.5625">9:16</option>
                                <option value="1">1:1</option>
                                <option value="custom" data-i18n="custom">비율 입력</option>
                            </select>
                        </div>
                        <div id="customRatioInput" class="ratio-inputs-row" style="display:none;">
                            <input type="number" id="ratioW" class="input-num" value="1"
                                oninput="setRatioFromInput('crop')">
                            <input type="number" id="ratioH" class="input-num" value="1"
                                oninput="setRatioFromInput('crop')">
                        </div>
                    </div>
                </div>

                <div class="action-row">
                    <button class="main-btn" id="downloadBtn" onclick="executeAction()" data-i18n="down">다운로드</button>
                    <div class="donation-btn" onclick="handleDonation()">
                        <span data-i18n="donate_text">도움이 되셨다면<br>아메리카노 한 잔 ☕</span>
                    </div>
                </div>
            </div>
        </div>

        <input type="file" id="fileInput" multiple accept="image/jpeg,image/png,image/webp,image/gif,image/*"
            style="display:none;" onchange="handleFiles(this.files)">
    </div>

    <div id="promptModal" class="qr-modal">
        <div class="qr-box" style="max-width: 500px; background: #1e1e1e; color: white;">
            <h3 id="promptTitle" style="color: var(--gem-accent);">프롬프트 안내</h3>
            <div class="prompt-view" id="promptText"></div>
            <button class="copy-btn" id="btnCopyPrompt" onclick="copyPrompt()">프롬프트 복사하기</button>
            <button class="close-qr" onclick="closePrompt()" style="background: #333;">닫기</button>
        </div>
    </div>

    <div id="qrModal" class="qr-modal">
        <div class="qr-box">
            <h3>☕ 카메라로 스캔해주세요</h3>
            <img src="https://github.com/two5220/assets/blob/main/kakao_qr.png?raw=true" alt="KakaoPay QR"
                class="qr-img">
            <button class="close-qr" onclick="closeQr()">닫기</button>
        </div>
    </div>

    <div id="policyModal" class="qr-modal">
        <div class="qr-box" style="max-width: 500px;">
            <h3 id="policyTitle">개인정보처리방침</h3>
            <div class="policy-content" id="policyText"></div>
            <button class="close-qr" onclick="closePolicy()">닫기</button>
        </div>
    </div>

    <script>
        /* [JS 로직 수정] */
        const FIX_X = 64, FIX_Y = 64, MASK_URL = "https://raw.githubusercontent.com/two5220/assets/refs/heads/main/mask.png";
        let maskImg = new Image(), maskData = null, maskW = 0, maskH = 0, previewImg = null, originalFile = null;
        let currentTab = 'split', colPos = [], rowPos = [], gridBox = { x1: 0, y1: 0, x2: 1, y2: 1 }, cropBox = { x: 0, y: 0, w: 1, h: 1 };
        let fixedRatio = 'full', currentTargetMB = 5.0, currentLang = 'ko';
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        let mobileSplitIdx = 0;
        const MAX_MOBILE_SPLIT = 50;

        // syncInputs 함수 제거 (입력 필드가 하나로 통합됨)

        const prompts = {
            stack: `역할 및 목표:\n* 사용자가 제공한 특정 주제나 3가지 개별 프롬프트를 바탕으로 절대적 16:9 가로 비율의 이미지 3장을 수직으로 나열한 단일 레이아웃 이미지를 기획하고 생성한다.\n* 각 영역(1구역, 2구역, 3구역)에 대해 일관성 있는 스타일이나 지시된 개별 내용을 충실히 반영한다.\n* 하나의 영역의 이미지는 다른 레이아웃 영역을 침범하지 않도록 엄격히 구분하며, 이미지 구분 경계선이나 바깥 테두리가 없는 매끄러운 연결을 지향합니다.\n* 생성된 이미지를 크롭할 것이기 때문에 생성가능한 최고해상도로 제공한다.`,
            side: `목적 및 목표:\n* 사용자가 제공한 주제나 3개의 프롬프트를 바탕으로 세로 비율(9:16) 이미지 3장이 가로로 나란히 배치된 단일 이미지 레이아웃(16:9 가로형)을 구성하는 '세로 비율 3장 레이아웃' 전문가 역할을 수행합니다.\n* 단일 주제가 주어지면 그에 맞는 3가지 장면을 스스로 구상하여 일관성 있는 레이아웃을 만듭니다.\n* 3개의 개별 프롬프트가 주어지면 각 프롬프트의 내용을 충실히 반영하여 3분할 레이아웃에 표현합니다.`
        };

        function showPrompt(type) {
            const title = type === 'stack' ? '가로 16:9 (수직 3단) 프롬프트' : '세로 9:16 (가로 3열) 프롬프트';
            document.getElementById('promptTitle').innerText = title;
            document.getElementById('promptText').innerText = prompts[type];
            document.getElementById('promptModal').classList.add('active');
            document.getElementById('btnCopyPrompt').innerText = '프롬프트 복사하기';
        }

        function closePrompt() { document.getElementById('promptModal').classList.remove('active'); }

        function copyPrompt() {
            const text = document.getElementById('promptText').innerText;
            navigator.clipboard.writeText(text).then(() => {
                document.getElementById('btnCopyPrompt').innerText = '✅ 복사 완료!';
                setTimeout(() => { document.getElementById('btnCopyPrompt').innerText = '프롬프트 복사하기'; }, 2000);
            });
        }

        function updateMobileGuide() { if (!isMobile) return; const guide = document.getElementById('mobileGuide'); if (guide) guide.innerHTML = t[currentLang].guide_mobile; }
        const KAKAO_LINK = "https://qr.kakaopay.com/Ej8NXO17Z";
        function handleDonation() { if (isMobile) { window.open(KAKAO_LINK, '_blank'); } else { document.getElementById('qrModal').classList.add('active'); } }
        function closeQr() { document.getElementById('qrModal').classList.remove('active'); }

        const flags = { ko: 'kr', en: 'us', cn: 'cn', jp: 'jp', in: 'in' };
        const t = {
            ko: {
                tab_split: "이미지<br class='pc-br'>분할", tab_crop: "이미지<br class='pc-br'>압축", visitors: "Today's Visitors", wm: "워터마크 제거", auto: "자동 저장", free: "직접 조절",
                row: "가로", col: "세로", border: "테두리", cut_ratio: "이미지 크기", target_cap: "압축 용량",
                p500: "500KB 이하", p1: "1MB 이하", p2: "2MB 이하", p5: "5MB 이하", full: "원본 (자유 변형)", custom: "비율 입력",
                down: "다운로드", sub: "화질 저하 없는 제미나이 워터마크 제거<br>고성능 이미지 분할과 이미지 압축",
                guide_m: "이미지를 이곳에 드래그 하거나<br>+ 버튼을 눌러주세요", guide_s: "워터마크 삭제는 제미나이만 지원합니다.<br>자동 저장 체크시 드래그만으로 자동 저장됩니다.",
                guide_mobile: "모바일은 보안 정책상 번호순으로<br>한 장씩 다운로드해야 합니다.",
                wait: "잠시 기다려주세요.", down_pair: "{n}번 다운로드", down_done_pair: "완료! {n}번 다운로드", all_done: "전체 완료 (다시 시작)",
                donate_text: "도움이 되셨다면<br>아메리카노 한 잔 ☕"
            },
            en: {
                tab_split: "Image<br class='pc-br'>Split", tab_crop: "Image<br class='pc-br'>Compress", visitors: "Today's Visitors", wm: "Remove Watermark", auto: "Auto Save", free: "Manual Adjust",
                row: "Rows", col: "Cols", border: "Border", cut_ratio: "Image Ratio", target_cap: "Compression",
                p500: "Under 500KB", p1: "Under 1MB", p2: "Under 2MB", p5: "Under 5MB", full: "Original (Free)", custom: "Custom Input",
                down: "Download", sub: "Lossless Gemini Watermark Removal<br>High Performance Split & Compress",
                guide_m: "Drag images here or<br>click the + button", guide_s: "Watermark removal supports Gemini only.<br>Auto-save on drag when 'Auto Save' is checked.",
                guide_mobile: "Due to security policy on mobile,<br>please download sequentially.",
                wait: "Please wait.", down_pair: "{n} Download", down_done_pair: "Done! {n} Download", all_done: "All Done (Restart)",
                donate_text: "If this helped,<br>Buy me an Americano ☕"
            }
        };
        function changeLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[lang] && t[lang][key]) el.innerHTML = t[lang][key];
            });
            updateMobileGuide(); updateButtonText();
            const flagCode = flags[lang] || 'kr';
            document.getElementById('currentFlag').src = `https://flagcdn.com/24x18/${flagCode}.png`;
        }
        window.addEventListener('DOMContentLoaded', () => { updateMobileGuide(); changeLanguage('ko'); switchTab('split'); });
        const todayStr = new Date().toISOString().slice(0, 10);
        const savedDate = localStorage.getItem('animo_date');
        let visitCnt = parseInt(localStorage.getItem('animo_visit') || '0');
        if (savedDate !== todayStr) { visitCnt = 0; localStorage.setItem('animo_date', todayStr); }
        if (!sessionStorage.getItem('session_active')) { visitCnt++; localStorage.setItem('animo_visit', visitCnt); sessionStorage.setItem('session_active', 'true'); }
        document.getElementById('cntVisit').innerText = visitCnt;
        const mainCont = document.getElementById('mainContainer');
        window.addEventListener('dragenter', (e) => { e.preventDefault(); document.getElementById('dropOverlay').classList.add('active'); });
        window.addEventListener('dragover', (e) => { e.preventDefault(); });
        mainCont.addEventListener('dragleave', (e) => { if (e.relatedTarget === null || !mainCont.contains(e.relatedTarget)) document.getElementById('dropOverlay').classList.remove('active'); });
        window.addEventListener('drop', (e) => { e.preventDefault(); document.getElementById('dropOverlay').classList.remove('active'); if (e.dataTransfer.files.length > 0) handleFiles(e.dataTransfer.files); });
        maskImg.crossOrigin = "Anonymous";
        maskImg.onload = () => { const c = document.createElement('canvas'); c.width = maskImg.width; c.height = maskImg.height; const ctx = c.getContext('2d'); ctx.drawImage(maskImg, 0, 0); const d = ctx.getImageData(0, 0, c.width, c.height).data; let minX = c.width, minY = c.height, maxX = 0, maxY = 0; for (let y = 0; y < c.height; y++) { for (let x = 0; x < c.width; x++) { if (d[(y * c.width + x) * 4] > 15) { minX = Math.min(minX, x); maxX = Math.max(maxX, x); minY = Math.min(minY, y); maxY = Math.max(maxY, y); } } } maskW = maxX - minX + 1; maskH = maxY - minY + 1; maskData = ctx.getImageData(minX, minY, maskW, maskH).data; };
        maskImg.src = MASK_URL;
        function setTargetMB(mb, btn) { currentTargetMB = mb; document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
        function toggleFreeMode() { resetGridPositions(); drawVisualizer(); }
        function clearFiles() { previewImg = null; originalFile = null; mobileSplitIdx = 0; updateButtonText(); document.getElementById('previewCanvas').style.display = 'none'; document.getElementById('guideText').style.display = 'flex'; document.getElementById('fileInput').value = ''; }
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            if (tab === 'split') {
                if (document.getElementById('pcTabSplit')) document.getElementById('pcTabSplit').classList.add('active');
                if (document.getElementById('mobTabSplit')) document.getElementById('mobTabSplit').classList.add('active');
                const sel = document.getElementById('ratioSelectSplit');
                if (sel) { sel.value = 'full'; handleRatioSelect(sel, 'split'); }
                // 입력 필드는 상단에 항상 표시됨 (숨기지 않음)
                if (document.getElementById('quickInputs')) document.getElementById('quickInputs').style.visibility = 'visible';
            } else {
                if (document.getElementById('pcTabCrop')) document.getElementById('pcTabCrop').classList.add('active');
                if (document.getElementById('mobTabCrop')) document.getElementById('mobTabCrop').classList.add('active');
                const sel = document.getElementById('ratioSelect');
                if (sel) { sel.value = 'full'; handleRatioSelect(sel, 'crop'); }
                // 압축 탭에서는 상단 입력(분할용) 숨김 처리하여 혼란 방지 (원하면 삭제 가능)
                if (document.getElementById('quickInputs')) document.getElementById('quickInputs').style.visibility = 'hidden';
            }
            document.getElementById('splitPanel').style.display = tab === 'split' ? 'grid' : 'none';
            document.getElementById('cropPanel').style.display = tab === 'crop' ? 'grid' : 'none';
            updateButtonText(); drawVisualizer();
        }
        function updateButtonText() { const btn = document.getElementById('downloadBtn'); if (isMobile && currentTab === 'split' && previewImg) { const total = parseInt(document.getElementById('colInput').value) * parseInt(document.getElementById('rowInput').value); if (mobileSplitIdx >= total) btn.innerText = t[currentLang].all_done; else { const txt = (mobileSplitIdx === 0) ? t[currentLang].down_pair : t[currentLang].down_done_pair; btn.innerText = txt.replace('{n}', mobileSplitIdx + 1); } } else btn.innerText = t[currentLang].down; }
        function handleRatioSelect(elem, type) { const val = elem.value; const customInputId = type === 'split' ? 'customRatioInputSplit' : 'customRatioInput'; const customInput = document.getElementById(customInputId); if (val === 'custom') { customInput.style.display = 'flex'; setRatioFromInput(type); } else if (val === 'full') { customInput.style.display = 'none'; setFixedRatio('full'); } else { customInput.style.display = 'none'; setFixedRatio(parseFloat(val)); } }
        function setFixedRatio(mode) { fixedRatio = mode; if (mode === 'full') { cropBox = { x: 0, y: 0, w: 1, h: 1 }; } drawVisualizer(); }
        function setRatioFromInput(type) { const wId = type === 'split' ? 'ratioWSplit' : 'ratioW'; const hId = type === 'split' ? 'ratioHSplit' : 'ratioH'; const w = parseFloat(document.getElementById(wId).value), h = parseFloat(document.getElementById(hId).value); if (w > 0 && h > 0) { fixedRatio = w / h; adjustCropToRatio(); } }
        function adjustCropToRatio() { if (!previewImg || !fixedRatio || fixedRatio === 'full') return; let r = fixedRatio; const imgRatio = previewImg.width / previewImg.height; if (r > imgRatio) { cropBox.w = 0.9; cropBox.h = (0.9 * imgRatio) / r; } else { cropBox.h = 0.9; cropBox.w = (0.9 * r) / imgRatio; } cropBox.x = (1 - cropBox.w) / 2; cropBox.y = (1 - cropBox.h) / 2; drawVisualizer(); }
        function resetGridPositions() { const cols = parseInt(document.getElementById('colInput').value), rows = parseInt(document.getElementById('rowInput').value); if (cols * rows > MAX_MOBILE_SPLIT && isMobile) { alert(`모바일 최대 ${MAX_MOBILE_SPLIT}분할 지원.`); document.getElementById('colInput').value = 1; document.getElementById('rowInput').value = 1; return; } colPos = []; rowPos = []; for (let i = 1; i < cols; i++) colPos.push(i / cols); for (let i = 1; i < rows; i++) rowPos.push(i / rows); mobileSplitIdx = 0; updateButtonText(); drawVisualizer(); }
        async function handleFiles(files) { const valid = Array.from(files).filter(f => f.type.startsWith('image/')); if (!valid.length) return; originalFile = valid[0]; const reader = new FileReader(); reader.onload = (e) => { previewImg = new Image(); previewImg.onload = async () => { document.getElementById('previewCanvas').style.display = 'block'; document.getElementById('guideText').style.display = 'none'; resetGridPositions(); if (document.getElementById('autoCheck').checked) { for (let file of valid.slice(0, 20)) await executeAction(file); } }; previewImg.src = e.target.result; }; reader.readAsDataURL(originalFile); }
        function drawVisualizer() { if (!previewImg) return; const canvas = document.getElementById('previewCanvas'), ctx = canvas.getContext('2d'); canvas.width = previewImg.naturalWidth; canvas.height = previewImg.naturalHeight; ctx.drawImage(previewImg, 0, 0); const cropP = parseFloat(document.getElementById('cropInput').value) / 100; if (currentTab === 'split') { const x1 = gridBox.x1 * canvas.width, y1 = gridBox.y1 * canvas.height, x2 = gridBox.x2 * canvas.width, y2 = gridBox.y2 * canvas.height, gw = x2 - x1, gh = y2 - y1, fCols = [0, ...colPos, 1], fRows = [0, ...rowPos, 1]; let cellNum = 1; for (let r = 0; r < fRows.length - 1; r++) { for (let c = 0; c < fCols.length - 1; c++) { const sx = x1 + fCols[c] * gw, sy = y1 + fRows[r] * gh, sw = (fCols[c + 1] - fCols[c]) * gw, sh = (fRows[r + 1] - fRows[r]) * gh; const mx = sw * cropP, my = sh * cropP; ctx.strokeStyle = "#00e676"; ctx.lineWidth = canvas.width / 110; ctx.strokeRect(sx + mx, sy + my, sw - mx * 2, sh - my * 2); const fs = Math.min(sw, sh) * 0.18; ctx.font = `bold ${fs}px Pretendard`; ctx.textAlign = "center"; ctx.textBaseline = "middle"; ctx.strokeStyle = "black"; ctx.lineWidth = fs / 10; ctx.strokeText(cellNum, sx + sw / 2, sy + sh / 2); ctx.fillStyle = "#00e676"; ctx.fillText(cellNum, sx + sw / 2, sy + sh / 2); cellNum++; } } } else { const cx = cropBox.x * canvas.width, cy = cropBox.y * canvas.height, cw = cropBox.w * canvas.width, ch = cropBox.h * canvas.height; ctx.strokeStyle = "#00e676"; ctx.lineWidth = canvas.width / 110; ctx.strokeRect(cx, cy, cw, ch); } }
        function handleStart(e) { } function handleMove(e) { } function handleEnd() { }
        async function executeAction(targetFile = null) { const fileToUse = targetFile || originalFile; if (!fileToUse) return; const btn = document.getElementById('downloadBtn'), originalText = t[currentLang].down; const targetMB = currentTargetMB, doWM = document.getElementById('wmCheck').checked, cropP = parseFloat(document.getElementById('cropInput').value) / 100; const img = await loadImage(fileToUse), base = fileToUse.name.replace(/\.[^/.]+$/, ""); if (currentTab === 'split') { const temp = document.createElement('canvas'); temp.width = img.width; temp.height = img.height; const tCtx = temp.getContext('2d'); tCtx.drawImage(img, 0, 0); if (doWM && maskData) applyEraser(tCtx, img.width, img.height); const x1 = gridBox.x1 * img.width, x2 = gridBox.x2 * img.width, y1 = gridBox.y1 * img.height, y2 = gridBox.y2 * img.height, gw = x2 - x1, gh = y2 - y1, fCols = [0, ...colPos, 1], fRows = [0, ...rowPos, 1], total = (fRows.length - 1) * (fCols.length - 1); if (isMobile) { if (mobileSplitIdx >= total) { mobileSplitIdx = 0; updateButtonText(); return; } const r = Math.floor(mobileSplitIdx / (fCols.length - 1)), c = mobileSplitIdx % (fCols.length - 1); let sx = x1 + fCols[c] * gw, sy = y1 + fRows[r] * gh, sw_p = (fCols[c + 1] - fCols[c]) * gw, sh_p = (fRows[r + 1] - fRows[r]) * gh; const mx = sw_p * cropP, my = sh_p * cropP, fw = Math.floor(sw_p - mx * 2), fh = Math.floor(sh_p - my * 2); const p = document.createElement('canvas'); p.width = fw; p.height = fh; p.getContext('2d').drawImage(temp, sx + mx, sy + my, fw, fh, 0, 0, fw, fh); p.toBlob(blob => save(blob, `${base}_${r + 1}-${c + 1}.${fileToUse.type.split('/')[1]}`), fileToUse.type, 1.0); mobileSplitIdx++; updateButtonText(); } else { btn.innerText = t[currentLang].wait; for (let r = 0; r < fRows.length - 1; r++) { for (let c = 0; c < fCols.length - 1; c++) { let sx = x1 + fCols[c] * gw, sy = y1 + fRows[r] * gh, sw_p = (fCols[c + 1] - fCols[c]) * gw, sh_p = (fRows[r + 1] - fRows[r]) * gh; const mx = sw_p * cropP, my = sh_p * cropP, fw = Math.floor(sw_p - mx * 2), fh = Math.floor(sh_p - my * 2); const p = document.createElement('canvas'); p.width = fw; p.height = fh; p.getContext('2d').drawImage(temp, sx + mx, sy + my, fw, fh, 0, 0, fw, fh); await new Promise(res => { p.toBlob(blob => { save(blob, `${base}_${r + 1}-${c + 1}.${fileToUse.type.split('/')[1]}`); setTimeout(res, 50); }, fileToUse.type, 1.0); }); } } btn.innerText = originalText; } } else { btn.innerText = t[currentLang].wait; const getBlob = async (q, s) => { const tw = Math.round(img.width * s), th = Math.round(img.height * s), tmp = document.createElement('canvas'); tmp.width = tw; tmp.height = th; const tc = tmp.getContext('2d'); tc.drawImage(img, 0, 0, tw, th); if (doWM && maskData) applyEraser(tc, tw, th); const cw = Math.round(cropBox.w * tw), ch = Math.round(cropBox.h * th), res = document.createElement('canvas'); res.width = cw; res.height = ch; res.getContext('2d').drawImage(tmp, Math.round(cropBox.x * tw), Math.round(cropBox.y * th), cw, ch, 0, 0, cw, ch); return new Promise(r => res.toBlob(b => r(b), 'image/jpeg', q)); }; let s = 1.0, q = 0.95; let finalBlob = null; const limit = targetMB * 1024 * 1024, minLimit = limit * 0.95, lQ = 0.05, hQ = 1.0, lS = 0.5, hS = 1.0; let lowQ = lQ, highQ = hQ, lowS = lS, highS = hS; for (let i = 0; i < 30; i++) { q = (lowQ + highQ) / 2; s = (lowS + highS) / 2; finalBlob = await getBlob(q, s); if (finalBlob.size > limit) { highQ = q; highS = s; } else if (finalBlob.size < minLimit) { lowQ = q; lowS = s; } else break; } save(finalBlob, `${base}_target_${targetMB}MB.jpg`); btn.innerText = originalText; } }
        function applyEraser(ctx, w, h) { const imgData = ctx.getImageData(0, 0, w, h), data = imgData.data, sx = w - maskW - FIX_X, sy = h - maskH - FIX_Y; for (let y = 0; y < maskH; y++) { for (let x = 0; x < maskW; x++) { const tx = sx + x, ty = sy + y; if (tx < 0 || ty < 0 || tx >= w || ty >= h) continue; const tIdx = (ty * w + tx) * 4, mIdx = (y * maskW + x) * 4, alpha = Math.min(maskData[mIdx] / 255, 0.98); if (alpha < 0.05) continue; const f = 1 / (1 - alpha); for (let k = 0; k < 3; k++) data[tIdx + k] = Math.max(0, Math.min(255, (data[tIdx + k] - 255 * alpha) * f)); } } ctx.putImageData(imgData, 0, 0); }
        function save(blob, name) { const a = document.createElement('a'), url = URL.createObjectURL(blob); a.href = url; a.download = name; document.body.appendChild(a); a.click(); setTimeout(() => { document.body.removeChild(a); URL.revokeObjectURL(url); }, 100); }
        function loadImage(file) { return new Promise(r => { const i = new Image(), url = URL.createObjectURL(file); i.onload = () => { URL.revokeObjectURL(url); r(i); }; i.src = url; }); }
        function openPolicy(type) { document.getElementById('policyTitle').innerText = type === 'privacy' ? '개인정보처리방침' : '이용약관'; document.getElementById('policyText').innerHTML = policies[type]; document.getElementById('policyModal').classList.add('active'); }
        function closePolicy() { document.getElementById('policyModal').classList.remove('active'); }
        const policies = { privacy: `<strong>1. 개인정보 처리 원칙</strong><br>Animo Pixel Master는 사용자의 이미지를 서버로 전송하지 않습니다.`, terms: `<strong>1. 서비스 목적</strong><br>이미지 분할 및 워터마크 제거 기능을 무료로 제공합니다.` };
    </script>
</body>

</html>
